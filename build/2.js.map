{"version":3,"sources":["../../src/pages/messages/messages.module.ts","../../src/components/message/message.module.ts","../../src/components/message/message.ts","../../src/pages/messages/messages.ts"],"names":[],"mappings":"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","file":"2.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { MessagesPage } from './messages';\n\nimport { MessageModule } from '../../components/message/message.module';\n\n@NgModule({\n  declarations: [\n    MessagesPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(MessagesPage),\n    MessageModule\n  ],\n})\nexport class MessagesPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/messages/messages.module.ts","import { NgModule } from '@angular/core';\nimport { MessageComponent } from './message';\nimport { IonicPageModule } from 'ionic-angular';\n\n@NgModule({\n\tdeclarations: [MessageComponent],\n\timports: [\n    IonicPageModule.forChild(MessageComponent)\n  ],\n\texports: [MessageComponent]\n})\nexport class MessageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/message/message.module.ts","import { Component, Input } from '@angular/core';\nimport { Message } from '../../models';\n\n@Component({\n  selector: 'message',\n  templateUrl: 'message.html'\n})\nexport class MessageComponent {\n  @Input() message: Message;\n  @Input() deleteMessage?: Function;\n\n  constructor() {}\n\n  public displayDate(created_at: string) {\n    const time = new Date(created_at);\n\n    const year = time.getFullYear();\n    const month = time.getMonth() + 1;\n    const date = time.getDate();\n\n    const hours = time.getHours();\n    const minutes = time.getMinutes();\n\n    return `${year}/${(month < 10 ? '0' : '') + month}/${(date < 10 ? '0' : '') + date} ${hours}:${minutes}`;\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/message/message.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, AlertController, LoadingController } from 'ionic-angular';\nimport { MessageProvider } from '../../providers/message';\nimport { Message } from '../../models';\nimport { AuthenticationProvider } from '../../providers/authentication';\n\n@IonicPage({\n  name: 'messages',\n  segment: 'messages'\n})\n@Component({\n  selector: 'page-messages',\n  templateUrl: 'messages.html',\n})\nexport class MessagesPage {\n\n  public messages: Message[] = [];\n  private next: number | null = null;\n\n  public deleteMessage: Function = this._deleteMessage.bind(this);\n\n  constructor(\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    private alertCtrl: AlertController,\n    private loadingCtrl: LoadingController,\n    private messageProvider: MessageProvider,\n    private authenticationProvider: AuthenticationProvider\n  ) {\n    if (!this.authenticationProvider.isAuthenticated || !this.authenticationProvider.isAdmin) {\n      this.navCtrl.setRoot('top');\n    }\n  }\n\n  public ionViewDidLoad() {\n    this.getMessages();\n    this.authenticationProvider\n      .getObserver()\n      .subscribe(isAuthenticated => {\n        if (!isAuthenticated) {\n          this.navCtrl.setRoot('top');\n        }\n      });\n  }\n\n  public async getMessages() {\n    try {\n      const response = await this.messageProvider.get();\n      this.messages = response.messages;\n      this.next = response.next;\n    } catch (_) {\n      await this.alertCtrl.create({\n        title: 'メッセージの取得に失敗しました',\n        buttons: ['OK']\n      }).present();\n    }\n  }\n\n  /** 新規メッセージを入力するプロンプトを表示する */\n  public addMessagePrompt() {\n    const prompt = this.alertCtrl.create({\n      title: 'メッセージ',\n      inputs: [{\n        name: 'title',\n        placeholder: 'タイトル'\n      }, {\n        name: 'message',\n        placeholder: 'メッセージ'\n      }],\n      buttons: [{\n        text: 'キャンセル',\n        role: 'cancel'\n      }, {\n        text: '検索',\n        handler: ({ title, message }) => {\n          if (title === '' || message === '') {\n            this.alertCtrl.create({\n              title: 'タイトル，メッセージは必ず入力する必要があります',\n              buttons: ['OK']\n            }).present();\n            return;\n          }\n\n          this.addMessage(title, message);\n        }\n      }]\n    });\n\n    prompt.present();\n  }\n\n  public async doRefresh(refresher) {\n    await this.getMessages();\n    refresher.complete();\n  }\n\n  public async doInfinite(infiniteScroll) {\n    if (this.next === null) {\n      infiniteScroll.complete();\n      return;\n    }\n\n    const response = await this.messageProvider.get(this.next);\n\n    this.messages = this.messages.concat(response.messages);\n    this.next = response.next || null;\n\n    infiniteScroll.complete();\n  }\n\n  /** 指定されたメッセージを削除するか確認する */\n  public async _deleteMessage(id: number) {\n    await this.alertCtrl.create({\n      title: 'このメッセージを削除しますか？',\n      buttons: [{\n        text: 'キャンセル',\n        role: 'cancel'\n      }, {\n        text: '削除する',\n        handler: () => {\n          this.delete(id);\n        }\n      }]\n    }).present();\n  }\n\n  /** 指定されたメッセージ ID のメッセージを削除する */\n  private async delete(id) {\n    const loading = this.loadingCtrl.create();\n    loading.present();\n\n    try {\n      await this.messageProvider.delete(id);\n      await this.alertCtrl.create({\n        title: '削除しました',\n        buttons: ['OK']\n      }).present();\n\n      this.getMessages();\n    } catch (_) {\n      await this.alertCtrl.create({\n        title: 'メッセージの削除に失敗しました',\n        buttons: [{\n          text: 'キャンセル',\n          role: 'cancel'\n        }, {\n          text: '再試行',\n          handler: () => {\n            this.delete(id);\n          }\n        }]\n      }).present();\n    }\n\n    loading.dismiss();\n  }\n\n  private async addMessage(title: string, message: string) {\n    const loading = this.loadingCtrl.create();\n    loading.present();\n\n    try {\n      await this.messageProvider.post(title, message);\n      this.getMessages();\n    } catch (error) {\n      await this.alertCtrl.create({\n        title: 'メッセージの作成に失敗しました',\n        buttons: [{\n          text: 'キャンセル',\n          role: 'cancel'\n        }, {\n          text: '再試行',\n          handler: () => {\n            this.addMessage(title, message);\n          }\n        }]\n      }).present();\n    }\n\n    loading.dismiss();\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/messages/messages.ts"],"sourceRoot":""}