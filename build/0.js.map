{"version":3,"sources":["../../src/pages/edit/edit.module.ts","../../src/pages/edit/edit.ts","../../src/components/tweet/tweet.module.ts","../../src/components/tweet/tweet.ts","../../src/components/media/media.module.ts","../../src/components/media/media.ts"],"names":[],"mappings":"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","file":"0.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { EditPage } from './edit';\n\nimport { TweetModule } from '../../components/tweet/tweet.module';\n\n@NgModule({\n  declarations: [\n    EditPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(EditPage),\n    TweetModule\n  ],\n})\nexport class EditPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/edit/edit.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, AlertController, Loading, LoadingController } from 'ionic-angular';\nimport { ListProvider } from '../../providers/list';\n\ninterface TemporaryState {\n  [key: string]: boolean;\n}\n\n@IonicPage({\n  name: 'edit',\n  segment: 'edit/:id'\n})\n@Component({\n  selector: 'page-edit',\n  templateUrl: 'edit.html',\n})\nexport class EditPage {\n\n  public name: string;\n\n  public listsTweets: any[] = [];\n  public temporaryState: TemporaryState = {};\n\n  /** this.temporaryState を参照する必要があるため this をバインドした状態のメソッドを子要素に渡す */\n  public changeSafeState: Function = this._changeSafeState.bind(this);\n\n  private id: number;\n\n  // フラグなどの状態を変更した後に保存したかどうかを保持する\n  private isSaved: boolean = true;\n\n  private loading: Loading;\n\n  constructor(\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    private alertCtrl: AlertController,\n    private loadingCtrl: LoadingController,\n    private listProvider: ListProvider\n  ) {\n    this.id = this.navParams.get('id');\n    this.name = this.navParams.get('name');\n\n    // 直接ページを開いた場合，前のページに戻るかリストページに遷移する\n    if (this.id === undefined || this.name === undefined) {\n      if (this.navCtrl.length() > 1) {\n        this.navCtrl.pop();\n        return;\n      }\n\n      this.navCtrl.setRoot('list');\n      return;\n    }\n  }\n\n  public ionViewDidLoad() {\n    this.getList();\n  }\n\n  /** 子要素にコールバック関数として渡す */\n  public _changeSafeState(id: number, isSafe: boolean) {\n    /*\n     * 子要素にメソッドを渡さずに Edit ページ側でクリックイベントを取得してフラグを更新する\n     * 子要素には変更したフラグを渡すようにしていたがうまくフラグが渡せなかったためメソッド自体を渡すようにした\n     * changeDetectorRef.detectChanges を呼び出してもうまく反映されなかった\n     */\n    this.temporaryState[id.toString()] = isSafe;\n\n    // 変更が加えられたため保存していない状態にする\n    this.isSaved = false;\n  }\n\n  /** リストを取得する */\n  public async getList() {\n    try {\n      this.loading = this.loadingCtrl.create();\n      this.loading.present();\n\n      const list = await this.listProvider.get(this.id);\n      this.listsTweets = (list as any).lists_tweets;\n\n      this.listsTweets.forEach(({ is_safe, tweet }) => {\n        this.temporaryState[tweet.id.toString()] = is_safe;\n      });\n    } catch (error) {\n      await this.alertCtrl.create({\n        title: 'リストの取得に失敗しました',\n        buttons: [{\n          text: 'キャンセル',\n          role: 'cancel',\n          handler: () => {\n            // どこかのページから移動してきた場合はそのページに戻る\n            if (this.navCtrl.length() > 1) {\n              this.navCtrl.pop();\n              return;\n            }\n\n            // 直接このページを開いている場合はリストページに戻る\n            this.navCtrl.setRoot('list');\n          }\n        }, {\n          text: '再試行',\n          handler: () => {\n            this.getList();\n          }\n        }]\n      }).present();\n    } finally {\n      this.loading.dismiss();\n    }\n  }\n\n  public async save() {\n    try {\n      this.loading = this.loadingCtrl.create();\n      this.loading.present();\n\n      const array = [];\n\n      for (let key in this.temporaryState) {\n        array.push({\n          id: key,\n          is_safe: this.temporaryState[key]\n        });\n      }\n\n      await this.listProvider.post(\n        this.id,\n        array\n      );\n\n      this.isSaved = true;\n\n      await this.alertCtrl.create({\n        title: '保存しました',\n        buttons: ['閉じる']\n      }).present();\n    } catch (error) {\n      this.alertCtrl.create({\n        title: '保存に失敗しました',\n        buttons: [{\n          text: 'キャンセル',\n          role: 'cancel'\n        }, {\n          text: '再試行',\n          handler: () => {\n            this.save();\n          }\n        }]\n      }).present();\n    } finally {\n      this.loading.dismiss();\n    }\n  }\n\n  /** 保存が完了していない場合は前のページに戻るかを確認する */\n  public ionViewCanLeave(): Promise<boolean> {\n    return new Promise((resolve) => {\n      if (!this.isSaved) {\n        this.alertCtrl.create({\n          title: '保存せずに終了しますか？',\n          buttons: [{\n            text: 'キャンセル',\n            role: 'cancel',\n            handler: () => {\n              resolve(false);\n            }\n          }, {\n            text: '終了',\n            handler: () => {\n              resolve(true);\n            }\n          }]\n        }).present();\n      } else {\n        resolve(true);\n      }\n    });\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/edit/edit.ts","import { NgModule } from '@angular/core';\nimport { TweetComponent } from './tweet';\nimport { IonicPageModule } from 'ionic-angular';\nimport { MediaModule } from '../media/media.module';\n\n@NgModule({\n\tdeclarations: [TweetComponent],\n\timports: [\n    IonicPageModule.forChild(TweetComponent),\n    MediaModule\n  ],\n\texports: [TweetComponent]\n})\nexport class TweetModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/tweet/tweet.module.ts","import { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'tweet',\n  templateUrl: 'tweet.html'\n})\nexport class TweetComponent {\n  @Input() tweet: any;\n  @Input() isSafe: boolean;\n\n  @Input() callback: any;\n\n  public user: any;\n  public media: any;\n  public mentions: any;\n\n  constructor() {}\n\n  public ngOnInit() {\n    this.user = this.tweet.user;\n    this.media = this.tweet.media;\n    this.mentions = this.tweet.mentions;\n  }\n\n  public changeSafeStatus() {\n    this.isSafe = !this.isSafe;\n    this.callback(this.tweet.id, this.isSafe);\n  }\n\n  public displayDate(created_at: string) {\n    const time = new Date(created_at);\n\n    const year = time.getFullYear();\n    const month = time.getMonth() + 1;\n    const date = time.getDate();\n\n    const hours = time.getHours();\n    const minutes = time.getMinutes();\n\n    return `${year}/${(month < 10 ? '0' : '') + month}/${(date < 10 ? '0' : '') + date} ${hours}:${minutes}`;\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/tweet/tweet.ts","import { NgModule } from '@angular/core';\nimport { MediaComponent } from './media';\nimport { IonicPageModule } from 'ionic-angular';\n\n@NgModule({\n\tdeclarations: [MediaComponent],\n\timports: [\n    IonicPageModule.forChild(MediaComponent)\n  ],\n\texports: [MediaComponent]\n})\nexport class MediaModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/media/media.module.ts","import { Component, Input } from '@angular/core';\nimport { Media } from '../../models';\n\n@Component({\n  selector: 'media',\n  templateUrl: 'media.html'\n})\nexport class MediaComponent {\n  @Input() media: Media[];\n\n  public photos: string[] = [];\n\n  constructor() {}\n\n  public ngOnInit() {\n    this.media.forEach(media => {\n      if (media.type === 'photo') {\n        this.photos.push(media.media_url);\n      }\n    });\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/media/media.ts"],"sourceRoot":""}